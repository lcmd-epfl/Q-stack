import copy
import numpy
import pyscf.data, pyscf.df, pyscf.scf

""" Taken from https://github.com/briling/aepm and modified """

class LB2020guess:

  acfile_default  = './parameters_HF.dat'

  def __init__(self, fname=None, parameters='HF'):
    self.get_basis(fname, parameters)

  def renormalize(self, a):
    # 1/norm1 = \int \exp(-a*r^2) d^3 r       => norm1 = (a/pi)^(3/2)
    # 1/norm2^2 = \int (\exp(-a*r^2))^2 d^3 r => norm2 = (2.0*a/pi)^(3/4)
    # coefficient = norm1 / norm2 = (0.5*a/pi)^(3/4)
    x = numpy.sqrt(numpy.sqrt(0.5*a/numpy.pi))
    return x*x*x

  def read_ac(self, fname):
    if fname==None:
      fname = self.acfile_default
    with open(fname) as f:
      lines = f.readlines()
    basis = {'H': []}
    il=0
    while il<len(lines):
      q,ng = map(int,lines[il].split())
      il+=1
      qbasis = []
      for ig in range(ng):
        a,c = map(float,lines[il].split())
        qbasis.append([0,[a, c*self.renormalize(a)]])
        il+=1
      basis[pyscf.data.elements.ELEMENTS[q]] = qbasis
    return basis

  def add_caps(self, basis):
    caps_array = numpy.zeros(103)
    caps_array  [  1 :   2 +1] = 1.0 /  3.0,
    caps_array  [  3 :   4 +1] = 1.0 / 16.0,
    caps_array  [  5 :  10 +1] = 1.0 /  3.0,
    caps_array  [ 11 :  12 +1] = 1.0 / 32.0,
    caps_array  [ 13 :  18 +1] = 1.0 /  8.0,
    caps_array  [ 19 :  20 +1] = 1.0 / 32.0,
    caps_array  [ 21 :  30 +1] = 1.0 /  6.0,
    caps_array  [ 31 :  36 +1] = 1.0 / 12.0,
    caps_array  [ 37 :  38 +1] = 1.0 / 32.0,
    caps_array  [ 39 :  48 +1] = 1.0 /  8.0,
    caps_array  [ 49 :  54 +1] = 1.0 / 12.0,
    caps_array  [ 55 :  70 +1] = 1.0 / 32.0,
    caps_array  [ 71 :  86 +1] = 1.0 / 12.0,
    caps_array  [ 87 : 102 +1] = 1.0 / 32.0
    for q in range(1,103):
      a = caps_array[q]
      qname = pyscf.data.elements.ELEMENTS[q]
      if qname in basis.keys():
        basis[qname].append( [0, [a, self.renormalize(a) ]] )
    return basis

  def get_basis(self, fname, parameters):
    if not parameters:
      acbasis = self.read_ac(fname)
      self.add_caps(acbasis)
      self.acbasis = acbasis
      self.parameters = None
    elif parameters=='HF':
      acbasis = {'H': [],
'He': [[0, [1.8865345899608519, 0.4056146926108746]]],
'Li': [[0, [1.9854870701524918, 0.842937532901041]]],
'Be': [[0, [4.744586184977778, 1.3574437702689057]], [0, [0.2792470137084066, 0.12818229520909]]],
'B': [[0, [6.0338581393756145, 2.094637525409216]], [0, [0.2296652845463048, 0.1538820056563987]]],
'C': [[0, [8.36842382629919, 2.912335066987576]], [0, [0.3175823851018592, 0.2825906903498745]]],
'N': [[0, [10.93399949627562, 3.848864491590766]], [0, [0.43457823405570917, 0.4666119106370673]]],
'O': [[0, [13.822779569568999, 4.823227937581987]], [0, [0.6163807631542392, 0.7589805047258943]]],
'F': [[0, [16.696221288447184, 5.913626376015676]], [0, [0.8069674335184295, 1.1067332169360984]]],
'Ne': [[0, [19.44766524633368, 7.113317051280908]], [0, [1.0081157441421305, 1.508827408605945]]],
'Na': [[0, [22.043514485429395, 8.505970515543133]], [0, [1.0688208368282481, 1.7698621680543754]]],
'Mg': [[0, [35.68089579776235, 9.370720219473146]], [0, [2.9023990296953044, 2.762905547578002]], [0, [0.391911845854857, 0.4395524604043637]]],
'Al': [[0, [34.328377368288, 11.458430900825965]], [0, [1.895391976451897, 2.8294008855907764]], [0, [0.12243916188522636, 0.09609543557391674]]],
'Si': [[0, [40.1763529442365, 13.078588758018803]], [0, [2.239495255980109, 3.340046848460941]], [0, [0.13204220229571037, 0.13836780632028686]]],
'P': [[0, [46.66493733746877, 14.784964733718208]], [0, [2.6279568276824814, 3.8907484994126014]], [0, [0.1594036030260791, 0.2054997181258127]]],
'S': [[0, [54.215297785332154, 16.531442577888246]], [0, [3.167647315145373, 4.489750969396064]], [0, [0.22671769463490918, 0.3487263502408896]]],
'Cl': [[0, [62.03053259370884, 18.377558847158248]], [0, [3.700397336007754, 5.10183267645642]], [0, [0.28974576291563425, 0.5086598918385119]]],
'Ar': [[0, [70.09781762916084, 20.327210911919742]], [0, [4.219331463603571, 5.7261201541458835]], [0, [0.35198503878294074, 0.6852541804555327]]],
'K': [[0, [81.43333911489003, 22.298648478534886]], [0, [4.962141983102695, 6.635182027193869]], [0, [0.3731894290462584, 0.8199734170834927]]],
'Ca': [[0, [74.41569962693416, 24.64109121546901]], [0, [4.071511193479644, 6.221216302620745]], [0, [0.28671657971452114, 0.6443784267175638]]],
'Sc': [[0, [101.20791061796358, 26.412487878859128]], [0, [6.446723728431389, 8.03204205372517]], [0, [0.7834045065030468, 1.0165590397404942]], [0, [0.22063826662337555, 0.32378518633489617]]],
'Ti': [[0, [114.39209603243822, 28.397321564939656]], [0, [7.751031064083496, 8.705787116537461]], [0, [1.3409079006639175, 1.4131635450481188]], [0, [0.29105515283701394, 0.5831178684215473]]],
'V': [[0, [128.16680647954118, 30.409558254731866]], [0, [9.216695666616227, 9.327297806386307]], [0, [1.858353853141026, 2.0326669623504348]], [0, [0.3403321818150978, 0.7596484454818172]]],
'Cr': [[0, [142.77227533657648, 32.44721271300131]], [0, [10.841336380933656, 9.962832486421375]], [0, [2.324791884735429, 2.760501995261298]], [0, [0.386053542334779, 0.9188917102547013]]],
'Mn': [[0, [158.3329221300052, 34.5079863370424]], [0, [12.618932464144514, 10.650940881473641]], [0, [2.751317714668748, 3.5518867608144586]], [0, [0.4313986524269153, 1.0757402574568604]]],
'Fe': [[0, [171.59971217722958, 36.95724348896622]], [0, [12.84888931599388, 12.016251508544268]], [0, [2.4208579434027238, 3.549284884553206]], [0, [0.44179048296062723, 1.0407595913547492]]],
'Co': [[0, [186.74822291999737, 39.328592943410854]], [0, [13.74313677181651, 13.158002775580817]], [0, [2.3981274633981866, 3.9707170856647522]], [0, [0.4585307413973846, 1.0414789524987433]]],
'Ni': [[0, [203.1786382537903, 41.69876688913565]], [0, [14.904507246734576, 14.254460551474274]], [0, [2.50518240559692, 4.554224625007843]], [0, [0.4821723138309187, 1.0776113454467862]]],
'Cu': [[0, [220.69456355904438, 44.09047093492658]], [0, [16.228087185242245, 15.352003273713255]], [0, [2.6799011471909333, 5.235665891996169]], [0, [0.5116345189692049, 1.1415411696644089]]],
'Zn': [[0, [239.22585729085247, 46.51256599644878]], [0, [17.67628445660993, 16.466826311793856]], [0, [2.8967970112707353, 5.996032281556834]], [0, [0.5457841216300788, 1.2269377067442289]]],
'Ga': [[0, [207.77682210003923, 50.56169123112327]], [0, [11.856343239908128, 17.3168271457457]], [0, [1.435457236821561, 4.342639055962598]], [0, [0.17389779129425226, 0.1653080552415563]]],
'Ge': [[0, [225.24685392781288, 53.26905157611517]], [0, [12.852764572486532, 18.78877288270596]], [0, [1.5215113800917213, 4.764856999241978]], [0, [0.1323014777214065, 0.14240658459873975]]],
'As': [[0, [247.9086110252744, 56.028840702070525]], [0, [14.300295034709391, 20.402255662442446]], [0, [1.6861444954415892, 5.341032330752718]], [0, [0.13416499137137874, 0.173484907424891]]],
'Se': [[0, [273.8649943966164, 58.799515164217304]], [0, [16.08110012602841, 22.06344368325976]], [0, [1.932031883742216, 6.021612670882894]], [0, [0.1792331056182616, 0.28093949286892783]]],
'Br': [[0, [300.01299028853975, 61.61553868303424]], [0, [17.856104656403406, 23.74892022762549]], [0, [2.1685919518796943, 6.686153971304707]], [0, [0.21670708306814743, 0.39290870861189514]]],
'Kr': [[0, [326.6902386555732, 64.48778748553242]], [0, [19.647882619248065, 25.46975468620672]], [0, [2.3989880465652473, 7.3449776683736046]], [0, [0.2510302844453139, 0.5108510489663171]]],
'Rb': [[0, [371.63737826238116, 67.11280281784138]], [0, [23.248544533094694, 27.589207985709436]], [0, [2.8726598551454177, 8.65313863037671]], [0, [0.2777391154691928, 0.6698990577646332]]],
'Sr': [[0, [370.72341161894167, 70.53669290120207]], [0, [22.369820917706722, 28.689970312925873]], [0, [2.74311782634614, 8.459944450402055]], [0, [0.2267095844986972, 0.568426058335472]]],
'Y': [[0, [381.9433918083273, 73.79627223351419]], [0, [22.657005971801517, 30.132831274164765]], [0, [2.78181561035276, 8.545479781705756]], [0, [0.23142082707081157, 0.6180042289006495]]],
'Zr': [[0, [404.12975489707895, 77.02187364839594]], [0, [23.913120490512053, 31.876617008220126]], [0, [2.928122394174498, 8.966554439771224]], [0, [0.2509660177582832, 0.715944254052498]]],
'Nb': [[0, [432.000753226581, 80.2736752206378]], [0, [25.649609677505364, 33.771572054045144]], [0, [3.127263691497556, 9.56516637789088]], [0, [0.27614878489011474, 0.8386582279030884]]],
'Mo': [[0, [462.68918558642525, 83.56383349210992]], [0, [27.620091978879955, 35.74744481883726]], [0, [3.350241541886852, 10.246548405106552]], [0, [0.3046372235349947, 0.9794709766343448]]],
'Tc': [[0, [495.0483050672117, 86.89968164312515]], [0, [29.724523813339573, 37.779386272068194]], [0, [3.584071928719099, 10.970538625909704]], [0, [0.3354202932589703, 1.135308320005783]]],
'Ru': [[0, [507.88917516825205, 90.49349034803686]], [0, [30.119638007448955, 39.47115792065111]], [0, [3.5989334168125757, 11.01711542201227]], [0, [0.36368976141299975, 1.2658304433949406]]],
'Rh': [[0, [524.9638375058429, 94.07757110910124]], [0, [30.919224799048706, 41.29611262024772]], [0, [3.6440391113842647, 11.211906105364292]], [0, [0.39297773558866045, 1.4040392885288977]]],
'Pd': [[0, [545.3714847389803, 97.68710808884666]], [0, [32.017351723397205, 43.22084107574552]], [0, [3.7145429669883927, 11.526806131814698]], [0, [0.4233961197550389, 1.5506684631945555]]],
'Ag': [[0, [568.4833402808085, 101.34010161842532]], [0, [33.34592493342003, 45.22617974954437]], [0, [3.805924686600645, 11.93953395818886]], [0, [0.45499468116272807, 1.7061526933158015]]],
'Cd': [[0, [593.885889821288, 105.04578226656376]], [0, [34.86259758880326, 47.30114504155227]], [0, [3.914677789101674, 12.43424303591464]], [0, [0.48779609479059793, 1.870799445536182]]],
'In': [[0, [745.0453334167443, 107.35066272796716]], [0, [47.58971626349325, 50.926236984161385]], [0, [5.971203828280484, 16.665850453251153]], [0, [0.7430042209193889, 3.01900686459137]], [0, [0.08466099556037841, 0.0621837900529884]]],
'Sn': [[0, [797.0285265417332, 110.81033718024638]], [0, [51.53384351159246, 53.28995874125511]], [0, [6.509259671570793, 17.920299624455424]], [0, [0.8054405533286846, 3.3669375931477203]], [0, [0.0663261465359773, 0.06275078847805306]]],
'Sb': [[0, [854.332635733605, 114.22836471354059]], [0, [56.03010644110775, 55.71293325193932]], [0, [7.143402312658964, 19.30403594352593]], [0, [0.8834712631942941, 3.765970580984084]], [0, [0.06733579855319452, 0.07997832797135018]]],
'Te': [[0, [912.166800137674, 117.7227728097036]], [0, [60.59380968267101, 58.126521408848]], [0, [7.8128697037188815, 20.648839233084743]], [0, [0.9864784933135154, 4.17777092264925]], [0, [0.1013950805635164, 0.14842059360104934]]],
'I': [[0, [971.2326574046591, 121.29884984899455]], [0, [65.25254319977338, 60.56284562091366]], [0, [8.49547368191436, 22.00152224539976]], [0, [1.0874117592443089, 4.595440718085864]], [0, [0.1269930211411724, 0.2193048890155139]]],
'Xe': [[0, [1031.8412270302938, 124.95241815534052]], [0, [70.03990230763266, 63.02489883673915]], [0, [9.196997644894727, 23.372474126117584]], [0, [1.1869856131289065, 5.023453919720388]], [0, [0.14857777514764356, 0.29253760225088343]]],
'Cs': [[0, [1149.3826345739149, 127.00628909302009]], [0, [82.07400302361911, 65.73151848347841]], [0, [11.211986732106572, 26.3413877290317]], [0, [1.527946233339621, 6.140575117802016]], [0, [0.20092255135604542, 0.5358903213328864]]],
'Ba': [[0, [1169.694775701659, 132.11174088077792]], [0, [81.77157679719838, 67.95207434814108]], [0, [11.07493150328844, 26.47785773461083]], [0, [1.5039225873956188, 6.206376352030552]], [0, [0.17008617153559455, 0.46825530317342057]]],
'La': [[0, [1222.2841796269504, 136.44950093257452]], [0, [85.30738538527056, 70.43142971440702]], [0, [11.534893922454101, 27.525891530415866]], [0, [1.565216495786674, 6.497397763993776]], [0, [0.17220089046882703, 0.5081058416183188]]],
'Ce': [[0, [1272.0807279952528, 141.03286793355306]], [0, [88.36657550864288, 72.8898142136249]], [0, [11.818291666733137, 28.480233667510007]], [0, [1.6071799883505355, 6.807847988718011]], [0, [0.18079491474660023, 0.5362729882922856]]],
'Pr': [[0, [1322.1469857952939, 145.7514595496068]], [0, [91.39656432137411, 75.33333265405476]], [0, [12.1071170797223, 29.4276517750929]], [0, [1.6537813057728807, 7.163429031604369]], [0, [0.18837281505285847, 0.5591574497687]]],
'Nd': [[0, [1372.5263581315082, 150.60889920740257]], [0, [94.38256339798501, 77.77663661280765]], [0, [12.388920046052041, 30.374947266803076]], [0, [1.7024088534425037, 7.543136623138128]], [0, [0.1952797675688985, 0.578520067184905]]],
'Pm': [[0, [1423.2939068289443, 155.6052462723981]], [0, [97.32865783461368, 80.22405611653822]], [0, [12.661617245227912, 31.327874011441633]], [0, [1.7523980768357152, 7.939936976159989]], [0, [0.20168624380514635, 0.5952857313410442]]],
'Sm': [[0, [1474.5487132299602, 160.73950011930427]], [0, [100.24430189239065, 82.67778973404094]], [0, [12.92552209508792, 32.292045829866765]], [0, [1.803472701882244, 8.350338175674331]], [0, [0.20769358126601012, 0.6100257919951613]]],
'Eu': [[0, [1526.4150536618301, 166.01206305202103]], [0, [103.1400484979067, 85.1394038516512]], [0, [13.18165318229166, 33.27271244759562]], [0, [1.8554646230381475, 8.772175676339293]], [0, [0.2133674470507607, 0.6231207671624414]]],
'Gd': [[0, [1578.9784735126057, 171.42174791339716]], [0, [106.0250115856627, 87.60976291496155]], [0, [13.431158961640053, 34.274486275744934]], [0, [1.908240993848972, 9.203901002823144]], [0, [0.218751211476024, 0.6348308667972493]]],
'Tb': [[0, [1627.9257815186743, 177.01885393927807]], [0, [108.58046918725347, 89.98169013002152]], [0, [13.712227614246242, 35.08177288335976]], [0, [1.9934065152409421, 9.778608254703611]], [0, [0.22607538133284424, 0.6586164748301768]]],
'Dy': [[0, [1675.7366368653, 182.79539454026207]], [0, [110.92891605390538, 92.35169430402841]], [0, [13.944492993755349, 35.88756038236498]], [0, [2.071361368544463, 10.324371945021113]], [0, [0.23293090457243362, 0.6793043698109138]]],
'Ho': [[0, [1722.45102323609, 188.74643520738246]], [0, [113.09508331285164, 94.71282327683552]], [0, [14.135448633292121, 36.700404016777306]], [0, [2.143446883392562, 10.84407478396342]], [0, [0.23939934892582107, 0.6974618085298848]]],
'Er': [[0, [1768.1273694341087, 194.86460193618592]], [0, [115.1045170512384, 97.059678831912]], [0, [14.292436046614585, 37.52919176101882]], [0, [2.210644796273452, 11.34014341321473]], [0, [0.24552713219420616, 0.7134490516878607]]],
'Tm': [[0, [1812.8387097425375, 201.1430178623664]], [0, [116.98049742273002, 99.38821488326626]], [0, [14.422182620212654, 38.38205159874525]], [0, [2.273693630826137, 11.81459993451274]], [0, [0.25134177827762766, 0.7275092899716751]]],
'Yb': [[0, [1856.6685254316594, 207.57575706111513]], [0, [118.7434510713386, 101.69567162657735]], [0, [14.53068606589803, 39.26596911718243]], [0, [2.333173888140194, 12.269202867396743]], [0, [0.25686096532697333, 0.7398210931489899]]],
'Lu': [[0, [1899.7375959050908, 214.15900283658507]], [0, [120.41203401518791, 103.9808323573287]], [0, [14.623290920474743, 40.186822923208226]], [0, [2.389573140054433, 12.70562314337766]], [0, [0.2620987513832905, 0.7505337675010088]]],
'Hf': [[0, [1967.3161513254126, 220.4818242350529]], [0, [124.34022381142523, 106.59712230324918]], [0, [15.07308379422105, 41.593870479307554]], [0, [2.480818570417923, 13.232329324645132]], [0, [0.2661713168622087, 0.7967557336599056]]],
'Ta': [[0, [2070.081376528822, 226.40779086022104]], [0, [131.49175287923276, 109.64042202051841]], [0, [15.99100132534389, 43.55837828988383]], [0, [2.6318773077354023, 14.102161904766191]], [0, [0.28043101980165813, 0.889950291909441]]],
'W': [[0, [2189.549358149728, 232.19925625507935]], [0, [140.25127395857805, 112.8716890901911]], [0, [17.13344756974962, 45.783279372087385]], [0, [2.8098978707573803, 15.126150439697248]], [0, [0.29967949093936525, 1.0098967362808797]]],
'Re': [[0, [2318.4462036806926, 237.9628858834694]], [0, [149.9937976368708, 116.1966038301959]], [0, [18.404731677310796, 48.15430966963478]], [0, [3.001608061476728, 16.225684227300484]], [0, [0.32187252568656627, 1.1489884194097733]]],
'Os': [[0, [2388.049070715689, 245.10047388036585]], [0, [153.7734923225801, 118.7983419940856]], [0, [18.857909721345862, 49.56025601814822]], [0, [3.11008633126925, 16.704279730923567]], [0, [0.34445180147113785, 1.2819732299675402]]],
'Ir': [[0, [2467.4297047382197, 252.25866435592235]], [0, [158.46189701303072, 121.50759831320175]], [0, [19.439726509029725, 51.14252734248185]], [0, [3.2301679883724033, 17.26079206285206]], [0, [0.36862565727337615, 1.4293825704029288]]],
'Pt': [[0, [2554.3592830018633, 259.50162267370445]], [0, [163.79362965973422, 124.30357066368583]], [0, [20.109681026841002, 52.84983429008009]], [0, [3.3577853513983555, 17.869227647362816]], [0, [0.3940749704373637, 1.58963560402845]]],
'Au': [[0, [2647.942367886888, 266.86258142778973]], [0, [169.65288496596833, 127.17818206724604]], [0, [20.849001035167127, 54.65811794336809]], [0, [3.490999195504156, 18.517519625282052]], [0, [0.42063212480622336, 1.761992991117359]]],
'Hg': [[0, [2747.928134675977, 274.3568830800225]], [0, [175.9987808231551, 130.12984199024015]], [0, [21.64967483069611, 56.556629698785166]], [0, [3.6289678032455828, 19.200696161193015]], [0, [0.44820670782959365, 1.946165274513181]]],
'Tl': [[0, [3164.4430017902673, 275.33425125783316]], [0, [215.72530656955274, 136.5134853959493]], [0, [27.161342191636468, 62.3870818915601]], [0, [4.491427780128169, 23.28557562205648]], [0, [0.600440165078794, 2.698540051334935]], [0, [0.06853093205018684, 0.04464665376841102]]],
'Pb': [[0, [3332.646311029052, 281.94999231460247]], [0, [229.0031090563242, 140.1437908618318]], [0, [28.975969438335593, 64.84409912856167]], [0, [4.810558525708687, 24.740295168731812]], [0, [0.6428089815920308, 2.996264069031993]], [0, [0.047924330717300866, 0.041440305792256264]]],
'Bi': [[0, [3512.216508855337, 288.64078359604133]], [0, [243.39214593688772, 143.84037317308596]], [0, [30.97853246581632, 67.34690546839133]], [0, [5.172423589452024, 26.30220507176237]], [0, [0.6972914789511377, 3.343004331160787]], [0, [0.046483440633541435, 0.051734625570903164]]],
'Po': [[0, [3687.56394734581, 295.7938412376767]], [0, [256.99663742660033, 147.48098812190506]], [0, [32.88525041027444, 69.69484331872636]], [0, [5.53728075165879, 27.772403578343333]], [0, [0.7669524019010989, 3.688915796422927]], [0, [0.07790941705971591, 0.10638615361580807]]],
'At': [[0, [3867.2700297383376, 303.2212169509859]], [0, [270.7970840945, 151.14251555680508]], [0, [34.83422183513534, 72.0152741956569]], [0, [5.916332606555011, 29.262941710845208]], [0, [0.8371425774457082, 4.051982567189525]], [0, [0.10024708223935702, 0.16345538990921718]]],
'Rn': [[0, [4051.137069750091, 310.9250988056561]], [0, [284.775937870393, 154.8229392338331]], [0, [36.824980911702696, 74.30862717101918]], [0, [6.309600846955326, 30.773810590825363]], [0, [0.9078056249178833, 4.433403377786259]], [0, [0.11834115297115232, 0.22290023511611973]]],
'Fr': [[0, [4353.984794381789, 316.43748235638924]], [0, [315.0221897544036, 158.68006092193193]], [0, [41.78089597517104, 77.69002281082362]], [0, [7.324635183209355, 33.751487240198095]], [0, [1.2167680803927787, 5.5432018138923755]], [0, [0.18531646855260042, 0.5267499036883455]]],
'Ra': [[0, [4448.350621866084, 326.7862729655624]], [0, [316.37235237572963, 162.10461390693163]], [0, [41.599655197053686, 78.94892733652733]], [0, [7.332003018858603, 34.0447122605427]], [0, [1.1859426306615157, 5.525797524492575]], [0, [0.16058344554826792, 0.4663667294265322]]],
'Ac': [[0, [4603.153156415366, 336.6052579927967]], [0, [324.3007110669224, 165.83572180244386]], [0, [42.43724662599295, 80.83159851353724]], [0, [7.489245069769097, 34.88956929049148]], [0, [1.1874081908615182, 5.619709507030846]], [0, [0.1516443671133239, 0.4600690932932841]]],
'Th': [[0, [4797.115103044666, 345.62274075733126]], [0, [338.2688019281645, 169.59801924262376]], [0, [44.29533540738354, 83.26599491898011]], [0, [7.831908387375935, 36.191673821065116]], [0, [1.2477414312105595, 5.98848264294172]], [0, [0.16327011497437025, 0.5198232907672228]]],
'Pa': [[0, [4988.384347334797, 355.26683210258017]], [0, [350.79261962815326, 173.42724087767974]], [0, [45.86062629910834, 85.59403110807175]], [0, [8.127515730749716, 37.310058714683365]], [0, [1.2948293491755238, 6.333674516621873]], [0, [0.17433619558418045, 0.5704050762598124]]],
'U': [[0, [5183.066162972329, 365.34950418100794]], [0, [362.8661720831389, 177.3353358479058]], [0, [47.296628009567854, 87.92696673647268]], [0, [8.393112085927632, 38.33948371626881]], [0, [1.3330953102037348, 6.665271903877122]], [0, [0.18401729827822358, 0.6114454029674808]]],
'Np': [[0, [5384.543572863619, 375.8372854168172]], [0, [374.92172838433873, 181.32316439868376]], [0, [48.68255893505675, 90.29615221964652]], [0, [8.643048125493124, 39.32468442063093]], [0, [1.366773826787788, 6.999180874689732]], [0, [0.19260759242970482, 0.6449897137528064]]],
'Pu': [[0, [5593.455128220382, 386.68279487022807]], [0, [387.1377374155312, 185.3845839171116]], [0, [50.05395085463852, 92.71346043659159]], [0, [8.883918591250191, 40.285846844592555]], [0, [1.3980540898103984, 7.34254653337652]], [0, [0.20029695125356592, 0.6723351335298008]]],
'Am': [[0, [5811.506710991388, 397.9252363037504]], [0, [399.6133434666023, 189.52305406251924]], [0, [51.42829601635813, 95.1840529019412]], [0, [9.11898176976415, 41.23292843473057]], [0, [1.428182916482645, 7.698670102009173]], [0, [0.20721869574024737, 0.6944251274901461]]],
'Cm': [[0, [6038.636135983948, 409.54741384643347]], [0, [412.3835587172814, 193.7348284033143]], [0, [52.81383174045898, 97.70910187250404]], [0, [9.34982889512178, 42.170969011372755]], [0, [1.4578869343677483, 8.06893586629329]], [0, [0.21346404640287797, 0.7119656673394167]]],
'Bk': [[0, [6260.948816390237, 422.0410453374906]], [0, [422.91662308239006, 197.9666685432441]], [0, [53.90461251056316, 99.8974110849659]], [0, [9.602570532994145, 42.922482192514806]], [0, [1.4984353150383831, 8.5490189788099]], [0, [0.21896757528599817, 0.7251176961416461]]],
'Cf': [[0, [6489.740134684498, 435.0218448995875]], [0, [433.34955871057997, 202.2541721796898]], [0, [54.94480645654533, 102.13481550166794]], [0, [9.83732955524915, 43.61885739445619]], [0, [1.5380653646173517, 9.027993242268069]], [0, [0.22430150549872171, 0.7368019584166986]]],
'Es': [[0, [6726.1549694950845, 448.53297901385343]], [0, [443.7204453771275, 206.597327749617]], [0, [55.94404617815157, 104.4220836472625]], [0, [10.056118549065122, 44.26511722213098]], [0, [1.5773227998811425, 9.508944788748774]], [0, [0.22947752376909678, 0.7472304930317006]]],
'Fm': [[0, [6970.136189873972, 462.57135978364494]], [0, [454.0434318759234, 210.99147916464239]], [0, [56.908789981374724, 106.75984221536478]], [0, [10.259912457405377, 44.864990614224354]], [0, [1.6164506247480044, 9.993218017831559]], [0, [0.23449400578056606, 0.7564937172127681]]],
'Md': [[0, [7223.144242560901, 477.19533902849173]], [0, [464.3482819478374, 215.43979750119988]], [0, [57.84502682099961, 109.14985702691983]], [0, [10.449227089089558, 45.42214815564216]], [0, [1.6555508524664384, 10.481198923814517]], [0, [0.23935006172299833, 0.7646522895633704]]],
'No': [[0, [7485.613396623628, 492.4146999962472]], [0, [474.6647744288757, 219.94073267865755]], [0, [58.76014532783936, 111.59422811133064]], [0, [10.624698106362063, 45.94171825601543]], [0, [1.6946873774494313, 10.973021567717673]], [0, [0.24404577984956427, 0.7717668700220324]]]}
      self.add_caps(acbasis)
      self.acbasis = acbasis
      self.parameters = 'HF'
    elif parameters=='HFS':
      self.acbasis = \
{'H': [[0, [0.0815877135278, 0.03846658840144482]]],
'He': [[0, [0.808048051263, 0.42950970838920094]]],
'Li': [[0, [2.60255347642, 0.9236581585938292]], [0, [0.0280604557276, 0.02092188631196157]]],
'Be': [[0, [4.59692793038, 1.5671644720955082]], [0, [0.0804833286681, 0.07687177344753668]]],
'B': [[0, [6.83323506001, 2.343454972959998]], [0, [0.128413097632, 0.15132206888434654]]],
'C': [[0, [9.78271998209, 3.2338673789342076]], [0, [0.220436310973, 0.29830455285829904]]],
'N': [[0, [13.0102305297, 4.234735126785875]], [0, [0.338162891505, 0.5080513541327736]]],
'O': [[0, [16.0693906158, 5.282243530372744]], [0, [0.486361793604, 0.7907181038567846]]],
'F': [[0, [19.101114431, 6.414979114451199]], [0, [0.654163546258, 1.1388759924473113]]],
'Ne': [[0, [21.8775289055, 7.6030507281160205]], [0, [0.840940013903, 1.552754282665946]]],
'Na': [[0, [39.3300572224, 8.771875563897146]], [0, [1.92102415925, 2.714794977091659]], [0, [0.07805961683, 0.0811487825176091]]],
'Mg': [[0, [44.5119316877, 10.28939716988604]], [0, [2.2032684956, 3.187374601857695]], [0, [0.0887611981764, 0.1080039414860704]]],
'Al': [[0, [48.8730920117, 11.90986953428574]], [0, [2.40497322587, 3.637221913420624]], [0, [0.0734291195179, 0.10551672569775308]]],
'Si': [[0, [57.6233652793, 13.49494028809413]], [0, [2.94976481323, 4.320831140260877]], [0, [0.105177215317, 0.17781870789022175]]],
'P': [[0, [66.8662881023, 15.16878399053013]], [0, [3.53343161485, 5.031541131577296]], [0, [0.143855885176, 0.2753173411346297]]],
'S': [[0, [77.3837213998, 16.887417337354126]], [0, [4.24286242552, 5.806114862351204]], [0, [0.19956804901, 0.42411499313349615]]],
'Cl': [[0, [87.9791594478, 18.69938754757193]], [0, [4.96724533871, 6.585294351730177]], [0, [0.25861139087, 0.5996439927014025]]],
'Ar': [[0, [98.6384890866, 20.607909307338506]], [0, [5.70477691943, 7.365867515604668]], [0, [0.322389303278, 0.8050942514147619]]],
'K': [[0, [127.304718328, 21.99381564116015]], [0, [8.14542318935, 8.914152537873168]], [0, [0.599909721308, 1.281113936405088]], [0, [0.035109044485, 0.03885492933110718]]],
'Ca': [[0, [143.410292528, 23.911082457093176]], [0, [9.37643144182, 9.941770494312644]], [0, [0.707265349098, 1.5157353597122245]], [0, [0.0458961284132, 0.06364796065031839]]],
'Sc': [[0, [158.994572671, 25.904442179513133]], [0, [10.6669154617, 10.883238053673036]], [0, [0.855948344081, 1.8492123402861176]], [0, [0.0663836669817, 0.10346527800168384]]],
'Ti': [[0, [174.894134206, 27.966990953941423]], [0, [11.9900959183, 11.826374216637854]], [0, [0.99956141908, 2.2420793288691643]], [0, [0.0831227117008, 0.13681731240170136]]],
'V': [[0, [190.604934656, 30.120471923041325]], [0, [13.3014644743, 12.749780443487515]], [0, [1.14767573276, 2.6800134943163965]], [0, [0.0996286409699, 0.17038950363938712]]],
'Cr': [[0, [206.066074361, 32.365170842752164]], [0, [14.5931480682, 13.65262763441227]], [0, [1.30088471274, 3.1620979075567597]], [0, [0.116182713597, 0.2045615376503895]]],
'Mn': [[0, [221.16302319, 34.70340183637225]], [0, [15.8499577468, 14.53121460187906]], [0, [1.45886982985, 3.6870872736982983]], [0, [0.132849408341, 0.23929909691538395]]],
'Fe': [[0, [236.275958236, 37.13636549602007]], [0, [17.0021924689, 15.423416039160818]], [0, [1.58039830539, 4.245713892974994]], [0, [0.138154959446, 0.24497443207694142]]],
'Co': [[0, [251.266826314, 39.654913061172365]], [0, [18.1259810867, 16.297312916228524]], [0, [1.72000963703, 4.847287712375843]], [0, [0.146811845647, 0.2591203258656231]]],
'Ni': [[0, [265.85589001, 42.264044242431645]], [0, [19.1913776924, 17.14653742887106]], [0, [1.87127991906, 5.488214209582658]], [0, [0.15768951119, 0.278567741559687]]],
'Cu': [[0, [279.89558372, 44.96377471419826]], [0, [20.1795701285, 17.969392784841585]], [0, [2.0307546413, 6.165773142025554]], [0, [0.170101920073, 0.30155942534387087]]],
'Zn': [[0, [293.316698633, 47.75086136824285]], [0, [21.0782849144, 18.76770516482975]], [0, [2.19628414783, 6.877297576296975]], [0, [0.183611811011, 0.32702068243576027]]],
'Ga': [[0, [223.351407737, 51.85980692866955]], [0, [13.8991890472, 16.536719699834574]], [0, [1.79766451577, 5.726042077556815]], [0, [0.101436081792, 0.1668401485879247]]],
'Ge': [[0, [246.769907155, 54.68127699607652]], [0, [15.4889775395, 17.96144762660623]], [0, [2.02770427595, 6.416697553920722]], [0, [0.121093071072, 0.22751860302804602]]],
'As': [[0, [270.61373978, 57.564175496815935]], [0, [17.0703038187, 19.413617521179415]], [0, [2.25845376191, 7.089265265044681]], [0, [0.143577215473, 0.3015460843175103]]],
'Se': [[0, [300.848605175, 60.466799135862026]], [0, [19.2537085333, 21.03082294851702]], [0, [2.56276392363, 7.936692573640534]], [0, [0.179389676325, 0.42001811250289295]]],
'Br': [[0, [328.797262949, 63.43810791545978]], [0, [21.1924514002, 22.57846913638884]], [0, [2.85204353045, 8.701657933885878]], [0, [0.215086275684, 0.5517188564364737]]],
'Kr': [[0, [355.214174754, 66.5014860746436]], [0, [22.9403228854, 24.090357342766612]], [0, [3.13032037939, 9.401485056551708]], [0, [0.251740278777, 0.6984900695917353]]],
'Rb': [[0, [514.90443499, 66.45387731817529]], [0, [39.0691107041, 29.02209698864997]], [0, [4.80426316714, 13.141490959616895]], [0, [0.563096338616, 1.4122294089225085]], [0, [0.0437868695146, 0.06021000634919698]]],
'Sr': [[0, [543.738995237, 69.61302407200955]], [0, [41.128661972, 30.45525713468061]], [0, [5.13125190812, 14.000583603948632]], [0, [0.584163639475, 1.502072088846565]], [0, [0.0457473904015, 0.07193642805575438]]],
'Y': [[0, [573.865438818, 72.8256986346715]], [0, [43.3418373882, 31.888048066550517]], [0, [5.52448276023, 14.85533123439925]], [0, [0.639200518782, 1.6690156488501313]], [0, [0.0565895915557, 0.0999066215124533]]],
'Zr': [[0, [618.872151787, 75.68769297760856]], [0, [47.1806876039, 33.6719208912133]], [0, [6.08833013219, 15.986254333511788]], [0, [0.716501829036, 1.9375575902411635]], [0, [0.0713273733558, 0.13612560832942924]]],
'Nb': [[0, [659.649771305, 78.78777525481571]], [0, [50.4574540637, 35.35272825043895]], [0, [6.61550206936, 17.019827159386775]], [0, [0.782993768027, 2.209716527541788]], [0, [0.0844791372764, 0.16887885100075942]]],
'Mo': [[0, [699.220087037, 82.03480488866288]], [0, [53.5109266255, 37.0105613980275]], [0, [7.13722099954, 18.0118404058805]], [0, [0.84688911897, 2.5015703606076256]], [0, [0.0970485492451, 0.20007447901252992]]],
'Tc': [[0, [738.224099414, 85.40820605841263]], [0, [56.4145863596, 38.665323565768624]], [0, [7.65973260957, 18.97333333242976]], [0, [0.910214479934, 2.8171999934246834]], [0, [0.109178173374, 0.22976890861393806]]],
'Ru': [[0, [778.546434184, 88.81655493493976]], [0, [59.5272531305, 40.349976300677305]], [0, [8.19597691306, 20.019036121376814]], [0, [0.94324592826, 3.1566525285906963]], [0, [0.110016658835, 0.22366236275456197]]],
'Rh': [[0, [823.569257154, 92.20831582218796]], [0, [63.1039857198, 42.120036402905754]], [0, [8.80656745978, 21.13062914191657]], [0, [0.997443318264, 3.555621798417296]], [0, [0.114146789352, 0.22823056867238134]]],
'Pd': [[0, [870.785579213, 95.65527378041557]], [0, [66.8564686032, 43.92776585899257]], [0, [9.45937938438, 22.26339050610234]], [0, [1.06293161212, 3.9977377213753678]], [0, [0.120329936612, 0.2388496753106151]]],
'Ag': [[0, [919.269642253, 99.18450014865658]], [0, [70.6762222363, 45.7571802751057]], [0, [10.1425268095, 23.40046850321277]], [0, [1.13573760258, 4.47761428381862]], [0, [0.12791270815, 0.25334823717250327]]],
'Cd': [[0, [968.604184045, 102.80825873069548]], [0, [74.5132242078, 47.60242594900452]], [0, [10.8507700928, 24.534003350659496]], [0, [1.21398140348, 4.993379192403898]], [0, [0.136511946916, 0.27055997696052425]]],
'In': [[0, [843.405124708, 110.96520306427927]], [0, [57.7349383985, 47.01539915999735]], [0, [9.2861062863, 21.19104807232844]], [0, [1.10262305907, 4.734376047579965]], [0, [0.0871639505153, 0.16198129973968295]]],
'Sn': [[0, [884.286663849, 114.96679724832346]], [0, [60.3792607664, 48.9682687896402]], [0, [9.80580254299, 22.0195379814388]], [0, [1.1950856195, 5.126927789028787]], [0, [0.0980413909659, 0.2050113690611363]]],
'Sb': [[0, [928.446756666, 119.0462561998037]], [0, [63.2301122301, 51.01110432146532]], [0, [10.334859026, 22.896873446536297]], [0, [1.2864338161, 5.510960266352291]], [0, [0.110597164197, 0.2557490251201422]]],
'Te': [[0, [1006.91297059, 122.5086188723354]], [0, [69.9563984769, 53.37878173194244]], [0, [11.3710909629, 24.795357618473698]], [0, [1.42210784675, 6.046549960417364]], [0, [0.134157895373, 0.3465874814433826]]],
'I': [[0, [1071.96922308, 126.39246353979226]], [0, [75.0210569929, 55.63865377654407]], [0, [12.2012216823, 26.216841337450926]], [0, [1.5460507813, 6.517948997414104]], [0, [0.156539597363, 0.44315588522145566]]],
'Xe': [[0, [1130.33961713, 130.57341813447323]], [0, [79.1625523503, 57.86111406775242]], [0, [12.9165161164, 27.39407258678573]], [0, [1.66262421031, 6.948688659111207]], [0, [0.178743239447, 0.5471697476001655]]],
'Cs': [[0, [1428.6078292, 128.82899897630176]], [0, [112.812659333, 62.53067152407603]], [0, [17.1798768915, 34.227961935433065]], [0, [2.21568367858, 8.479278930585247]], [0, [0.337292691131, 1.0003736377349504]], [0, [0.0255963992844, 0.03279972807297557]]],
'Ba': [[0, [1523.81269929, 132.33374253222377]], [0, [121.683219116, 64.98719011675838]], [0, [18.5377225373, 36.123991347012996]], [0, [2.42239198451, 9.151849111983358]], [0, [0.37464487939, 1.1313217747067679]], [0, [0.0318322692155, 0.05088369770736389]]],
'La': [[0, [1601.41213596, 136.45908437706606]], [0, [128.13744821, 67.27340937055364]], [0, [19.6176760354, 37.63312362169784]], [0, [2.60445015787, 9.70137042264615]], [0, [0.410586721293, 1.2723058645673604]], [0, [0.0407833256045, 0.07329654046194856]]],
'Ce': [[0, [1658.47048562, 141.23225188668434]], [0, [132.175071965, 69.19731594670756]], [0, [20.5059445332, 38.7164904908682]], [0, [2.74661595209, 10.37163705261105]], [0, [0.44440565431, 1.4015607510299235]], [0, [0.0447234791579, 0.08190699460978135]]],
'Pr': [[0, [1715.26288637, 146.15656574406643]], [0, [136.051409723, 71.1296245077095]], [0, [21.3888165255, 39.75113375394901]], [0, [2.89289683236, 11.083749067340108]], [0, [0.479036909221, 1.535278321067373]], [0, [0.0484113375519, 0.09010431008530405]]],
'Nd': [[0, [1771.7679871, 151.23596000355406]], [0, [139.763308576, 73.0683098482763]], [0, [22.2678147838, 40.737595040425745]], [0, [3.04417565147, 11.835768086134143]], [0, [0.514725872587, 1.674859379548526]], [0, [0.051944834864, 0.09809792639764876]]],
'Pm': [[0, [1827.66270931, 156.48142428705057]], [0, [143.259770003, 75.01290712875812]], [0, [23.1358417402, 41.66771534375595]], [0, [3.199640873, 12.62445386651362]], [0, [0.55121096113, 1.8197816596901466]], [0, [0.0553253104444, 0.10584644293996817]]],
'Sm': [[0, [1882.00387559, 161.91851435984526]], [0, [146.409075469, 76.95898454189155]], [0, [23.9752478278, 42.51900002843879]], [0, [3.35734325422, 13.444573455091518]], [0, [0.58792965549, 1.9681143031964388]], [0, [0.0585081846119, 0.1131824248041495]]],
'Eu': [[0, [1932.75854719, 167.6002366798858]], [0, [148.934876865, 78.89578945074894]], [0, [24.7493435866, 43.242193431261235]], [0, [3.51366553918, 14.286616540326525]], [0, [0.623904660384, 2.115867151197456]], [0, [0.0614016764838, 0.1198007548367038]]],
'Gd': [[0, [1975.59820781, 173.62835263535527]], [0, [150.267478001, 80.80228887933148]], [0, [25.3812097224, 43.730413811304885]], [0, [3.66178046197, 15.131436422018986]], [0, [0.657389398602, 2.2552290399910286]], [0, [0.063837005797, 0.1251673713840444]]],
'Tb': [[0, [2043.29310958, 179.2037445859498]], [0, [154.366907789, 83.0695482866181]], [0, [26.2243318766, 44.71490580298028]], [0, [3.7689949755, 16.120004675463715]], [0, [0.663323872601, 2.2895066251146168]], [0, [0.0627463378236, 0.12027956081283321]]],
'Dy': [[0, [2104.40136331, 185.1021613728763]], [0, [157.480965804, 85.29961820416767]], [0, [26.9609319436, 45.495087853775985]], [0, [3.88372694635, 17.1127505005226]], [0, [0.672078437777, 2.338126517300418]], [0, [0.0616039775116, 0.1156643841617586]]],
'Ho': [[0, [2154.45469909, 191.42238595600696]], [0, [159.026925085, 87.48357952837262]], [0, [27.5027486946, 45.95633835932799]], [0, [3.99631996625, 18.08974262324885]], [0, [0.680954465184, 2.3885052181436106]], [0, [0.060173741041, 0.1106488289229826]]],
'Er': [[0, [2190.94335259, 198.20792842426218]], [0, [158.679181523, 89.64609353716017]], [0, [27.7793550439, 46.00785816969023]], [0, [4.10121508569, 19.03368366564328]], [0, [0.688486025083, 2.4335494796515578]], [0, [0.0583244945524, 0.10492614812539582]]],
'Tm': [[0, [2214.48978734, 205.42335133632005]], [0, [156.520247439, 91.85354642909319]], [0, [27.7527332692, 45.61394284204278]], [0, [4.19629401273, 19.931108844198004]], [0, [0.69439592841, 2.4709679915183504]], [0, [0.0560809223751, 0.09861920356341443]]],
'Yb': [[0, [2229.17694813, 212.95081901943223]], [0, [153.095425598, 94.19509432925543]], [0, [27.4346946752, 44.83036127743994]], [0, [4.28220834088, 20.774850510083816]], [0, [0.699283130104, 2.502096031620723]], [0, [0.0536017037618, 0.09215131893680198]]],
'Lu': [[0, [2240.76323234, 220.64120470655195]], [0, [149.186347076, 96.73527206213477]], [0, [26.882917845, 43.799061576056026]], [0, [4.36078494051, 21.56356820520379]], [0, [0.703938851713, 2.529434335353653]], [0, [0.0510727969004, 0.08594615780727508]]],
'Hf': [[0, [2597.75786792, 221.4984988672269]], [0, [188.512068741, 99.90153962759624]], [0, [33.1238337682, 51.910671812884125]], [0, [4.95610698524, 24.075881834623832]], [0, [0.840126255104, 3.0993574039786624]], [0, [0.0754290091254, 0.14830089683149864]]],
'Ta': [[0, [2835.12187643, 224.97090244390182]], [0, [212.567396461, 103.35145847528267]], [0, [36.6312660085, 56.10051046630536]], [0, [5.37947393132, 25.81036889369674]], [0, [0.929151975174, 3.4952140173242676]], [0, [0.0934277241824, 0.20126674008286047]]],
'W': [[0, [3025.30468794, 229.72846917871507]], [0, [230.276064677, 106.62250063664358]], [0, [39.2800873493, 59.00619946134962]], [0, [5.75689567535, 27.33479438233774]], [0, [1.00224682037, 3.845156936516533]], [0, [0.109770850673, 0.2527564765722409]]],
'Re': [[0, [3195.61889568, 235.18655723502508]], [0, [245.095364506, 109.79052780485154]], [0, [41.5829628586, 61.378152855515665]], [0, [6.12180336884, 28.778519952039215]], [0, [1.06873134848, 4.1880086644629335]], [0, [0.12566089767, 0.3051098407321521]]],
'Os': [[0, [3269.8476374, 242.79909040960803]], [0, [247.725409062, 112.31392244158873]], [0, [42.3817611068, 62.06265168735337]], [0, [6.3443841081, 29.935902842018656]], [0, [1.06629631325, 4.327346089905066]], [0, [0.129797938525, 0.311692170282036]]],
'Ir': [[0, [3376.87667402, 250.01523976524726]], [0, [254.046404976, 115.1096116274901]], [0, [43.6319269616, 63.23965630985516]], [0, [6.61971894051, 31.182376053342995]], [0, [1.08166412391, 4.55923508274026]], [0, [0.135494138077, 0.32374501274030015]]],
'Pt': [[0, [3503.10050982, 257.11908266124726]], [0, [262.371870877, 118.06427561966308]], [0, [45.1400059471, 64.68067709627911]], [0, [6.9289515116, 32.48110151528869]], [0, [1.1081209327, 4.853290082621408]], [0, [0.142293514583, 0.3395090236627465]]],
'Au': [[0, [3642.37385874, 264.24694689878606]], [0, [271.922734082, 121.13071183685847]], [0, [46.8125693251, 66.2730681995686]], [0, [7.26324418491, 33.8141784669834]], [0, [1.14228427509, 5.19507983319498]], [0, [0.149995980588, 0.358211807740868]]],
'Hg': [[0, [3791.49387942, 271.4719140255812]], [0, [282.287772429, 124.2856953523547]], [0, [48.5988727445, 67.95563981054985]], [0, [7.61787984362, 35.17197803197935]], [0, [1.18217257465, 5.576807483854668]], [0, [0.158470192072, 0.37936980854301705]]],
'Tl': [[0, [2936.57544261, 296.6310154714052]], [0, [169.521034982, 128.06139769860988]], [0, [27.7278154244, 47.591482085503884]], [0, [6.18159381819, 28.12073706100974]], [0, [0.937899869214, 4.530828450871838]], [0, [0.0878953169292, 0.17357741811050326]]],
'Pb': [[0, [3009.77971351, 305.25255358884556]], [0, [171.15240957, 131.55698757943694]], [0, [27.3362555847, 48.331254479828324]], [0, [6.28851042826, 28.17024630706816]], [0, [0.974528662433, 4.702910510256614]], [0, [0.0938717769309, 0.2034350353550231]]],
'Bi': [[0, [3115.8496148, 313.8093294029781]], [0, [175.822879115, 134.97757970713243]], [0, [27.7224718639, 49.668864571379345]], [0, [6.46561267924, 28.69206651328442]], [0, [1.01344607802, 4.8981241805735936]], [0, [0.101357420858, 0.238854699432195]]],
'Po': [[0, [3389.7826553, 320.66212678156774]], [0, [197.70471693, 137.6782930250117]], [0, [32.7684432058, 53.54264845480374]], [0, [7.20421362633, 32.282004781869944]], [0, [1.12137629162, 5.45713798816872]], [0, [0.122511534693, 0.3260853416866197]]],
'At': [[0, [3615.64824975, 328.23201750107296]], [0, [214.627481704, 140.75596703512562]], [0, [36.212401456, 56.77561235809897]], [0, [7.72251960097, 34.59419860541525]], [0, [1.20498118619, 5.86665441892619]], [0, [0.140743435239, 0.4111765886798949]]],
'Rn': [[0, [3822.43609476, 336.350129170213]], [0, [229.112932587, 144.07512932334393]], [0, [38.9069689318, 59.56038725013068]], [0, [8.15670864482, 36.44005731475775]], [0, [1.27699233159, 6.209274469973415]], [0, [0.157920555428, 0.49843705889064177]]],
'Fr': [[0, [5482.49524373, 319.6645485275319]], [0, [423.079084959, 150.95938898566172]], [0, [69.2009027293, 87.27661177977454]], [0, [10.8608508924, 46.439279301313775]], [0, [1.90646535073, 8.470741952248504]], [0, [0.346917622534, 1.1656662095666177]], [0, [0.0307550493062, 0.04426509178665867]]],
'Ra': [[0, [5824.22217495, 326.4339512907625]], [0, [453.52449169, 155.42009100679874]], [0, [73.3773009492, 90.8040545340973]], [0, [11.464490496, 48.34987083896135]], [0, [2.03967356151, 9.0403262759412]], [0, [0.371641031126, 1.2738484791994147]], [0, [0.0352213028729, 0.0608041346622409]]],
'Ac': [[0, [6036.5236009, 335.7796360977328]], [0, [467.073213456, 159.12991928763344]], [0, [75.5296659631, 92.69417995252799]], [0, [11.8777377991, 49.82342721622108]], [0, [2.11757248944, 9.395644277773304]], [0, [0.381340313268, 1.3369398526252363]], [0, [0.0383652274726, 0.07276437615219129]]],
'Th': [[0, [5781.02789712, 352.98106098074595]], [0, [422.978272928, 160.16991432703165]], [0, [70.6991828424, 88.76304121503837]], [0, [11.6767574085, 49.81457199002962]], [0, [1.97848007739, 9.160629598977392]], [0, [0.331860385876, 1.1973801004966318]], [0, [0.026439636441, 0.0440542374768854]]],
'Pa': [[0, [6470.70044306, 355.6321452303036]], [0, [493.225990334, 166.6023122006732]], [0, [79.745338563, 96.26732853658515]], [0, [12.7459791331, 52.8675409376038]], [0, [2.24462222504, 10.084915235025559]], [0, [0.426863180027, 1.5811923530178016]], [0, [0.046081696294, 0.09023405892146073]]],
'U': [[0, [6677.40964538, 366.3604410199135]], [0, [503.945262015, 170.3320215371999]], [0, [81.5371062053, 97.81121245233369]], [0, [13.1666520998, 54.33056511073182]], [0, [2.29389178189, 10.443579781479114]], [0, [0.446656456574, 1.692621958244384]], [0, [0.0486532127186, 0.09517496550595222]]],
'Np': [[0, [6876.97988756, 377.6727808046505]], [0, [512.988616603, 174.062836818793]], [0, [83.094841748, 99.18659693335287]], [0, [13.577303204, 55.73888881006303]], [0, [2.33602765587, 10.819245703537456]], [0, [0.463908300107, 1.7929280737098292]], [0, [0.0503407579225, 0.09771182678295015]]],
'Pu': [[0, [7073.46467092, 389.4767458720515]], [0, [520.913132774, 177.82649815105037]], [0, [84.4759601259, 100.44506864340687]], [0, [13.9835865192, 57.10032981294112]], [0, [2.37396977934, 11.219928664816145]], [0, [0.479267778382, 1.8834054685337047]], [0, [0.0513447915011, 0.09846227430507107]]],
'Am': [[0, [7268.46090414, 401.81608908117465]], [0, [527.78044655, 181.63697263440923]], [0, [85.6760899888, 101.59181640122917]], [0, [14.3850956892, 58.408919501602334]], [0, [2.40863549995, 11.647846175973653]], [0, [0.492763833865, 1.9631974676672352]], [0, [0.0517261402691, 0.0976668611720969]]],
'Cm': [[0, [7461.07270308, 414.6785096263954]], [0, [533.554758233, 185.49522592946025]], [0, [86.6825832446, 102.6241476347959]], [0, [14.7808918438, 59.65650561763819]], [0, [2.44083150917, 12.104436105449656]], [0, [0.504445261811, 2.0318083591637333]], [0, [0.05153336688, 0.09554389071702431]]],
'Bk': [[0, [7834.61665484, 425.45484503199054]], [0, [559.731032607, 190.24065973922345]], [0, [90.3490076906, 105.5123797523743]], [0, [15.4132069342, 61.660011790470044]], [0, [2.50033510705, 12.766578648339491]], [0, [0.518065291853, 2.1191379396217878]], [0, [0.0502100687403, 0.09121645646373851]]],
'Cf': [[0, [8201.72850818, 436.9331462249914]], [0, [584.091204457, 194.97482137107826]], [0, [93.761139844, 108.17900966131799]], [0, [16.0367739256, 63.59285048454238]], [0, [2.55798346418, 13.447343479938588]], [0, [0.530648155402, 2.197810376070656]], [0, [0.0488334639026, 0.08694654953904225]]],
'Es': [[0, [8568.60789377, 449.0720813904205]], [0, [607.252250672, 199.7280083883994]], [0, [96.9993255946, 110.69452133675912]], [0, [16.6586969315, 65.47695911971626]], [0, [2.61542700505, 14.151859950374625]], [0, [0.542629123426, 2.2703523785804616]], [0, [0.0474279857112, 0.0828159494077535]]],
'Fm': [[0, [8937.95057321, 461.81915524070774]], [0, [629.550428909, 204.51466732620824]], [0, [100.107987123, 113.0978434843216]], [0, [17.2830930058, 67.32473882802411]], [0, [2.67360927633, 14.882691359072656]], [0, [0.554298517748, 2.3385277257658816]], [0, [0.0460161264899, 0.07887980370375362]]],
'Md': [[0, [9312.72294426, 475.2053390594495]], [0, [651.169079559, 209.34968317990007]], [0, [103.107616035, 115.4101662912288]], [0, [17.9118103054, 69.14191004315032]], [0, [2.73292190404, 15.640711247342152]], [0, [0.565798602387, 2.4032865063709417]], [0, [0.0446097028095, 0.07515373722237267]]],
'No': [[0, [9692.47931286, 489.2442112346279]], [0, [672.034303671, 214.23197488829172]], [0, [105.988550516, 117.63038685999115]], [0, [18.5442146559, 70.92646079341314]], [0, [2.7932429022, 16.425417198806798]], [0, [0.577107028367, 2.4645969790388342]], [0, [0.0432042120982, 0.07161106318788321]]]}
      self.parameters = 'HFS'


  def use_charge(self, mol):
      if self.parameters == 'HF':
          acbasis = copy.deepcopy(self.acbasis)
          factor = 1.0-mol.charge/mol.natm
          for q in acbasis.keys():
              acbasis[q][-1][1][1] *= factor
      else:
          acbasis = self.acbasis
      return acbasis

  def use_ecp(self, mol, acbasis):
      acbasis = copy.deepcopy(acbasis)
      for iat, z in enumerate(mol.atom_charges()):
          q = mol.atom_pure_symbol(iat)
          zcore = pyscf.data.elements.charge(q) - z
          if zcore > 0:
              zrest = zcore
              bad_idx = []
              for iprim in range(len(acbasis[q])):
                  if numpy.isclose(zrest, 0):
                      break
                  a, c = acbasis[q][iprim][1]
                  renorm = self.renormalize(a)
                  c /= renorm  # convert back to charge units: sum {c} == charge(q)
                  dc = min(c, zrest)
                  if numpy.isclose(c, dc):
                      bad_idx.append(iprim)
                  else:
                      acbasis[q][iprim][1][1] = (c-dc)*renorm
                  zrest -= dc
              for i in bad_idx[::-1]:
                  acbasis[q].pop(i)
      return acbasis

  def get_auxweights(self, auxmol):
      w = numpy.zeros(auxmol.nao)
      iao = 0
      for iat in range(auxmol.natm):
          q = auxmol._atom[iat][0]
          for prim in auxmol._basis[q]:
              w[iao] = prim[1][1]
              iao+=1
      return w

  def merge_caps(self, w, eri3c):
      return numpy.einsum('...i,i->...', eri3c, w)

  def get_eri3c(self, mol, auxmol):
      pmol       = mol + auxmol
      shls_slice = (0, mol.nbas, 0, mol.nbas, mol.nbas, mol.nbas+auxmol.nbas)
      eri3c      = pmol.intor('int3c2e_sph', shls_slice=shls_slice)
      return eri3c

  def check_coefficients(self, mol, acbasis):
      ch1 = sum(sum(c/self.renormalize(a) for _, (a, c) in acbasis[mol.atom_pure_symbol(iat)]) for iat in range(mol.natm))
      ch2 = sum(mol.atom_charges()) - (mol.charge if self.parameters == 'HF' else 0)
      assert numpy.isclose(ch1, ch2)

  def HLB20(self, mol):
      acbasis = self.use_charge(mol)
      if mol.has_ecp():
          acbasis = self.use_ecp(mol, acbasis)
      self.check_coefficients(mol, acbasis)

      auxmol  = pyscf.df.make_auxmol(mol, acbasis)
      eri3c   = self.get_eri3c(mol, auxmol)
      auxw    = self.get_auxweights(auxmol)
      return self.merge_caps(auxw, eri3c)

  def Heff(self, mol):
      self.mol   = mol
      self.Hcore = pyscf.scf.hf.get_hcore(mol)
      self.H     = self.Hcore + self.HLB20(mol)
      return self.H


  def HLB20_ints_generator(self, mol, auxmol):
      pmol  = mol + auxmol
      shls_slice = (0, mol.nbas, 0, mol.nbas, mol.nbas, mol.nbas+auxmol.nbas)
      eri3c2e_ip1 = pmol.intor('int3c2e_ip1', shls_slice=shls_slice) # (nabla \, \| \)
      eri3c2e_ip2 = pmol.intor('int3c2e_ip2', shls_slice=shls_slice) # ( \, \| nabla\)
      aoslices = mol.aoslice_by_atom()[:,2:]
      auxaoslices = auxmol.aoslice_by_atom()[:,2:]
      def HLB20_ints_deriv(iat):
          p0, p1 = aoslices[iat]
          P0, P1 = auxaoslices[iat]
          eri3c2e_ip = numpy.zeros_like(eri3c2e_ip1)
          eri3c2e_ip[:,p0:p1,:,:] += eri3c2e_ip1[:,p0:p1,:,:]
          eri3c2e_ip[:,:,p0:p1,:] += eri3c2e_ip1[:,p0:p1,:,:].transpose((0,2,1,3))
          eri3c2e_ip[:,:,:,P0:P1] += eri3c2e_ip2[:,:,:,P0:P1]
          return -eri3c2e_ip
      return HLB20_ints_deriv

  def HLB20_generator(self, mol):
      acbasis = self.use_charge(mol)
      if mol.has_ecp():
          acbasis = self.use_ecp(mol, acbasis)
      self.check_coefficients(mol, acbasis)
      auxmol  = pyscf.df.make_auxmol(mol, acbasis)
      eri3c   = self.HLB20_ints_generator(mol, auxmol)
      auxw    = self.get_auxweights(auxmol)
      def HLB20_deriv(iat):
          return self.merge_caps(auxw, eri3c(iat))
      return HLB20_deriv
